# 设计文档

## TUN/TAP 的最简单用法

参考 [simpletun](https://github.com/gregnietsky/simpletun) 可以实现端到端的通信,这里暂且命名为 Client.

```txt
┌──────────┐  ┌──────────┐
│ Client A ├──┤ Client B │
└──────────┘  └──────────┘
```

## 在 Client A 和 Client B 中间加个 Server 进行转发

在端到端通信的基础上,中间添加一个设备,只进行两个设备之间的流量转发.对于两个 Client 来说收发的流量没有任何变化.

```txt
┌──────────┐  ┌────────┐  ┌──────────┐
│ Client A ├──┤ Server ├──┤ Client B │
└──────────┘  └────────┘  └──────────┘
```

## 给 Server 加上路由的能力

在转发的基础上, Server 分析由 Client 上报的三层报文,根据目的地址进行路由,就可以实现多个 Client 之间的通信

```txt
              ┌────────┐
     ┌────────┤ Server ├───────┐
     │        └───┬────┘       │
     │            │            │
┌────┴─────┐ ┌────┴─────┐ ┌────┴─────┐
│ Client A │ │ Client B │ │ Client C │
└──────────┘ └──────────┘ └──────────┘
```

## 在 Server 所在机器上部署一个 Client

在 Server 所在物理机上部署 Client X, 这个 Client 与其他 Client 没有任何区别. 此时就可以实现所有设备之间的通信.

```txt
             ┌──────────┐
             │ Client X │
             └────┬─────┘
                  │
              ┌───┴────┐
     ┌────────┤ Server ├───────┐
     │        └───┬────┘       │
     │            │            │
┌────┴─────┐ ┌────┴─────┐ ┌────┴─────┐
│ Client A │ │ Client B │ │ Client C │
└──────────┘ └──────────┘ └──────────┘
```

## 使用 WebSocket 进行设备间通信

由于某些众所周知的原因,需要使用运行在 HTTPS 握手之后的 WebSocket 进行设备间通信.
